---
title: "Análisis de presencias con procesos de puntos" 
subtitle: "Generalidades"
author: "Gerardo Martín"
fontsize: 11pt
output: 
  beamer_presentation:
    theme: metropolis
    highlight: pygments
    slide_level: 3
    fig_height: 6
    fig_caption: true
    latex_engine: xelatex
    keep_tex: true
date: '2022-06-29'
bibliography: Referencias.bib
csl: chicago-author-date.csl
---

# Introducción

### ¿Qué es un patrón de puntos?

-   Base de datos de cosas o eventos en espacio 

```{r patron, echo = F, fig.cap="Patrones de puntos de densidad variable. A la izquierda células de mucosa gástrica en corte histológico. A la derecha, cúmulos de galaxias (Baddeley et al. 2016).", fig.dim = "20%", dpi=450}
knitr::include_graphics("Figuras/Patrón-puntos.png")
```

- Densidad $\rightarrow$ conteos/unidad espacial

### La intensidad de puntos

```{r echo = F, fig.cap="Ejemplo de medición de intensidad de puntos", fig.width=7, dpi = 400, fig.dim = "30%"}
knitr::include_graphics("Figuras/Ejemplo-patron-puntos.png")
```


### Tipos de puntos

Puntos pueden representar tipos de objetos

```{r tipos-puntos, echo = F, fig.cap="Ubicaciones de dos especie de árbol, abeto y roble, en la misma parcela.", fig.dim="30%"}
knitr::include_graphics("Figuras/Tipos-puntos.png")
```

### Tipos de puntos

Puntos pueden representar mediciones

```{r tipos-puntos-2, echo=F, fig.cap="Ubicaciones de árboles con mediciones de diámetro.", fig.dim="30%", dpi = 450}
knitr::include_graphics("Figuras/Tipos-puntos-med.png")
```

### Tipos de puntos

Puntos pueden estar definidos en 1-4 dimensiones

```{r dimensiones, echo = F, fig.cap="Ejemplos de procesos de puntos en 1 y 3 dimensiones", fig.dim = "30%", dpi = 450}
knitr::include_graphics("Figuras/1-3D.png")
```

### Covariables

Los procesos de puntos pueden estar definidos en relación a covariables.

```{r covar, echo = F, fig.cap="Datos de Beilschmiedia pendula sobre un modelo digital de elevación.", fig.dim="30%", dpi = 450}
knitr::include_graphics("Figuras/Covariables.png")
```

### Tipos de PPMs

- Completamente aleatorios (homogéneos)

- *Heterogéneos*

    - Procesos de puntos generalmente producidos por covariables

- Agregados

### El modelado de procesos de puntos

- Estimar variación de densidad

- Densidad = No. puntos / unidad de área

```{r cont-estim, echo = F, fig.cap="Se analiza un patrón para predecir variación contínua.",fig.dim="30%", dpi = 400}
knitr::include_graphics("Figuras/Conteos-estimacion.png")
```

- Estadísticamente, densidad puede tratarse con la distribución Poisson

### Procesos de puntos en ecología

- Datos más comunes $\rightarrow$ sólo presencia

- Colecciones de patrones de puntos

```{r colecciones, echo = F, fig.cap="Repositorios comunes de información de biodiversidad.", fig.dim="30%", dpi = 450}
knitr::include_graphics("Figuras/Repositorios.png")
```

# Análisis de procesos de puntos

### Es un análisis regresión

- Medir relación entre $x$ y $y$

    - ¿Cómo afecta $x$ al promedio de $y$?

- $x$ produce a $y$

    - $x$ variable independiente
    - $y$ variable dependiente de $x$
    
### Ejemplo - Datos contínuos

En regresión lineal simple, tendríamos dos variables contínuas:

```{r echo = F}
set.seed(123)

x <- rnorm(100)
beta <- rnorm(100, 0, 1)
y <- x + beta

df <- data.frame(x = x, y = y)

knitr::kable(head(df))
```

### Ejemplo - Gráfica de dispersión

A las cuales realizamos un análisis exploratorio:

```{r echo=F, fig.height=3.5, fig.width=3.5}
with(df, plot(x, y, col = "red"))
```

### Ejemplo - Regresión lineal

- Siendo un poco más generales que arriba y asumiendo que $y$ es un patrón de puntos, podemos tener modelos de regresión así:

$$ y(x) = \alpha + \beta_1 x_1 + \dots + \beta_n x_n + \varepsilon$$
- $x$ son las variables ambientales

- $y$ es la intensidad por unidad de área

- $\alpha$ es el intercepto, y $\beta_i$ son los efectos de $x$ sobre $y$

    - Cuánto va a cambiar $y$ si "aumento" el valor de  $x$ en una unidad

- $\varepsilon$  es el error, varianza de $y$ que $x$ no explica

### Ejemplo - La línea de regresión

```{r echo = F, fig.height=4, fig.width=4}
plot(x, y, col = "red")
abline(0, 1, col = "red")
```

### Ejemplo - La ecuación

En el caso simple anterior:

- $y = \alpha + \beta \times x$

- $\alpha = 0$

- $\beta = 1$

**Regresión consiste en estimar todos los coeficientes para las variables** $x$.

### Paréntesis

En un modelo de regresión lineal, tenemos:

- $W$ son mediciones de peso en Kg, y su modelo es:

$$W = \alpha + \beta Edad + \beta_{Sexo} + \varepsilon$$

- Donde las unidades que produce el modelo son peso en Kg

### Modelos de nicho y distribución

- Mediciones: coordenadas de presencia

- ¿Qué unidades produce el modelo estadístico para los puntos de presencia?

### Diferencias entre regresión y PPs

- Regresión lineal simple
    
    - $-\infty > y < \infty$, $y \in \mathbb{R}$
    -  $y \approx \mathcal{N}$ (distribución Normal)
    
- Procesos de puntos 

    - $y > 0$, $y \in \mathbb{Z}$
    - $y \approx \mathcal{P}$ (distribución Poisson)
    
### Diferencias entre regresión y PPs

Para que $y >0$

- Regresión lineal

    - $y(x) = \alpha + \beta_1 x_1 + \dots$

- Regresión log-lineal

    - $\log y(x) = \alpha + \beta_1 x_1 + \dots$
    
    - es decir: 
    
    $$y(x)  = \exp(\alpha + \beta_1 x_1 + \dots)$$

### Relación con métodos populares en MNE

```{r echo=F, fig.dim="30%", dpi = 350, fig.align='center'}
knitr::include_graphics("Figuras/Equivalencia-maxent.png")
```

### Gráficamente

```{r echo = F, fig.dim="30%", dpi = 300, fig.align='center'}
knitr::include_graphics("Figuras/Maxent-PPMs.png")
```

### Los modelos ajustados

$$\ln \pi(g_i ) = \ln \mu(g_i ) = x(g_i) \beta$$

Son funciones log-lineales equivalentes de un conjunto de predictores

- Maxent: maximiza la entropía ($\pi (g_i)$)

- Procesos de puntos en general: maximizan verosimilitud Poisson (conteo  de puntos por unidad espacial)

### Comparaciones extensivas

- Equivalentes a MaxEnt

    - Sin Regularización
    - *Features* lineal y cuadrática
    
```{r maxent, echo = F, dpi=400}
knitr::include_graphics("Figuras/Renner.png")
```

### Relación con otros métodos

- Regresión log-lineal

    - Logística
    - Maxent

- Elipsoides (Martín et al. 2022)

    - Centroide existe en espacio
    - Sin colinealidad

### Relación con otros métodos

Condiciones para equivalencia entre MPPs y envolturas

```{r evm, echo = F, fig.dim="30%", dpi=400}
knitr::include_graphics("Figuras/Discrep.png")
```

### Relación con otros métodos

```{r echo = F, fig.align='center', fig.dim="30%", dpi=400, fig.cap="Frecuencia de condiciones ambientales en sitios de presencia para dos variables no correlacionadas."}
knitr::include_graphics("Figuras/Figuras-centroide/Stat-density.png")
```

### Relación con otros métodos

```{r echo = F, fig.align='center', fig.dim="30%", dpi=350, fig.cap="Distancia al centroide en dos dimensiones ambientales no correlacionadas"}
knitr::include_graphics("Figuras/Figuras-centroide/Distance-centroid.png")
```

### Relación con otros métodos

```{r echo = F, fig.align='center', fig.dim="30%", dpi=400, fig.cap="Intensidad de puntos en dos dimensiones ambientales no correlacionadas para el mismo proceso de puntos."}
knitr::include_graphics("Figuras/Figuras-centroide/Point-intensity.png")
```

### Las lecciones

- Procesos de puntos son la herramienta *ad-hoc* para puntos
- Maxent es una herramienta estadística de regresión, per se, no genera distribuciones

    - Favorabilidad, idoneidad son interpretaciones de los valores producidos
    
    -  Los valores producidos representan el número esperado de puntos de presencia (exceptuando la salida logística)

- Los PPMs son más transparentes, y por medio de `spatstat`:

    - Herramientas exploratorias, estimar y comparar efectos, diagnosticar modelos
    - Modelar estructura espacial


### Desventajas  de PPMs vs Maxent

- Formateo
- Difícil automatizar
- Más programación
- Selección de modelo laboriosa
- Optimización puede ser difícil
- Poco práctico si analizaremos muchas especies

### Bibliografía básica

```{r spat-book, echo =FALSE, fig.dom = "30%", dpi = 300, fig.align='center'}
knitr::include_graphics("Figuras/Spat-book.png")
```

